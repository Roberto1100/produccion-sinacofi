<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<MapBrokers xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="MapBrokers_2.xsd">
   <MapBroker dmlCompatibility="2.1" id="cf0945b0-28c2-4639-a6c9-bddbb3e71ab9" label="" lastModified="2024-08-30T13:28:07.000Z" name="MAPSERVICE_Sinacofi_D10_F1_D10_FRONT::MAPSERVICE.Sinacofi_D10_F1.Calcular_Cam" xmlVersion="1.0">
      <DmlMapBroker>
         <InputBusinessDocuments>
            <InputBusinessDocument>
               <BusinessDocument id="5a26c413-5426-4534-8607-9d23965d6be1">
                  <name>MAPSERVICE_Sinacofi_D10_F1_D10_FRONT::MAPSERVICE.Sinacofi_D10_F1\ArchivosEntrada.D10_Archivo_Datos</name>
                  <lastModified>2024-08-30T13:25:44.000Z</lastModified>
               </BusinessDocument>
               <Alias>in</Alias>
            </InputBusinessDocument>
         </InputBusinessDocuments>
         <DecisionPath>
            <StepMappingRule>
               <MappingRule id="1cb16b97-c668-4742-bf9c-e7da78efdc15" label="" lastModified="2024-08-30T13:28:08.000Z" name="MAPSERVICE_Sinacofi_D10_F1_D10_FRONT::MAPSERVICE.Sinacofi_D10_F1.Calcular_Campos:Calcular_Campos" xmlVersion="1.0">
                  <OutputBusinessDocument id="29b6fc93-a3f5-4ed1-bd2a-a3828141c0b1">
                     <name>MAPSERVICE_Sinacofi_D10_F1_D10_FRONT::MAPSERVICE.Sinacofi_D10_F1\Salida.D10_Caratula_Salida</name>
                     <lastModified>2024-08-30T13:25:44.000Z</lastModified>
                  </OutputBusinessDocument>
                  <MappingElement ElementReferenceId="3">
                     <Expression>
                        <DmlExpression><![CDATA[count( \Details )
]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="2">
                     <Expression>
                        <DmlExpression><![CDATA[getSubString( in:\Header\Datos,8,8 )]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="6">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGS]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="7">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGT]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="8">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGV]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="9">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGW]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="10">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGX]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="12">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGZ]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="13">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCIA]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="14">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCIB]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="15">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCIC]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="16">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCID]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="17">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCHW]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="18">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCHY]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="11">
                     <Expression>
                        <DmlExpression><![CDATA[%totalCGY:=0;
%totalCGZ:=0;
%totalCIA:=0;
%totalCIB:=0;
%totalCIC:=0;
%totalCID:=0;	
%totalCHW:=0;
%totalCHY:=0;
    loop on \Details {
		if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "4" ) 
         then {
			%totalCGY:=%totalCGY + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
  	  if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "5" ) 
         then {
			%totalCGZ:=%totalCGZ + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
      if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "6" ) 
         then {
			%totalCIA:=%totalCIA + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
    if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "7" ) 
         then {
			%totalCIB:=%totalCIB + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
      if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "8" ) 
         then {
			%totalCIC:=%totalCIC + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
     if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "9" ) 
         then {
			%totalCID:=%totalCID + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };         
	    if ( getSubString( this\Contenido, 61, 1 ) = "2"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) in ("1","2","3","4","5","6","7","8","9")) 
         then {
			%totalCHW:=%totalCHW + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };               
	    if ( getSubString( this\Contenido, 61, 1 ) in ("1","2") and  getSubString( this\Contenido, 62, 2 ) = "07") 
         then {
			%totalCHY:=%totalCHY + convertToI( getSubString( this\Contenido, 65, 14 ))
	            }               
    };
%totalCGY]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="5">
                     <Expression>
                        <DmlExpression><![CDATA[%rutConcatenadosCGQ]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
                  <MappingElement ElementReferenceId="4">
                     <Expression>
                        <DmlExpression><![CDATA[%rutConcatenadosCGP:="|";
%rutConcatenadosCGQ:="|";
%totalCGS:=0; 
%totalCGT:=0;
%totalCGV:=0;
%totalCGW:=0;
%totalCGX:=0;
    loop on \Details {
        if(  getSubString( this\Contenido, 61, 1)="1" ) then { 
            if (countString( %rutConcatenadosCGP, "|"&getSubString( this\Contenido, 1, 10)&"|" ) =0 )
        then {
        %rutConcatenadosCGP:=%rutConcatenadosCGP&getSubString(this\Contenido, 1, 10)&"|"  
                 }
               };
         if (  getSubString( this\Contenido, 61, 1)="2" ) then {
             if (countString( %rutConcatenadosCGQ, "|"&getSubString( this\Contenido, 1, 10)&"|" ) =0 )
             then {
        %rutConcatenadosCGQ:=%rutConcatenadosCGQ&getSubString(this\Contenido, 1, 10)&"|"  
                 }
         };
         if ( getSubString( this\Contenido, 61, 1 ) = "1"  and not(getSubString( this\Contenido, 62, 2 ) ="07") and getSubString( this\Contenido, 64, 1 ) = "0" ) 
         then {
			%totalCGS:=%totalCGS + convertToI( getSubString( this\Contenido, 65, 14 ))
	            }; 
         if ( getSubString( this\Contenido, 61, 1 ) = "2"  and getSubString( this\Contenido, 62, 2 ) in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "0" ) 
         then {
			%totalCGT:=%totalCGT + convertToI( getSubString( this\Contenido, 65, 14 ))
	            }; 
         if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "1" ) 
         then {
			%totalCGV:=%totalCGV + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
         if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "2" ) 
         then {
			%totalCGW:=%totalCGW + convertToI( getSubString( this\Contenido, 65, 14 ))
	            };
         if ( getSubString( this\Contenido, 61, 1 ) = "1"  and  getSubString( this\Contenido, 62, 2 )  in ("01","02","03","04","05","06","07","08","09","10","11") and getSubString( this\Contenido, 64, 1 ) = "3" ) 
         then {
			%totalCGX:=%totalCGX + convertToI( getSubString( this\Contenido, 65, 14 ))
	            }
  };
  %rutConcatenadosCGP:= countString(%rutConcatenadosCGP, "|") -1;
  %rutConcatenadosCGQ:= countString(%rutConcatenadosCGQ, "|") -1; 
%rutConcatenadosCGP]]></DmlExpression>
                     </Expression>
                     <Comment/>
                  </MappingElement>
               </MappingRule>
               <StepOutput>
                  <OutputName>out</OutputName>
               </StepOutput>
            </StepMappingRule>
            <StepOutput>
               <OutputName>out1</OutputName>
               <InputBusinessDocumentAlias>in</InputBusinessDocumentAlias>
            </StepOutput>
            <StepOutput>
               <OutputName>out2</OutputName>
               <InputBusinessDocumentAlias>in</InputBusinessDocumentAlias>
            </StepOutput>
            <StepStep>
               <DmlExpression><![CDATA[%correlativoPrefijo:= getSubString(getAttribute( "B2BXGIReceive_ConsumptionFilename" ), 5, 8 );
setDocumentAttributeToOutput( "out1",  "B2BXGISend_ProductionFilename",%correlativoPrefijo &"_datosSalida");
setDocumentAttributeToOutput( "out2",  "B2BXGISend_ProductionFilename",getSubString(getAttribute("B2BXGIReceive_ConsumptionFilename" ), 5, 255) + getAttribute( "B2BXGIReceive_ConsumptionExtension"))]]></DmlExpression>
            </StepStep>
         </DecisionPath>
      </DmlMapBroker>
   </MapBroker>
</MapBrokers>
